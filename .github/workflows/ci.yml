name: SqliteUtil-ci

on:
  push:
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup SQLite and directories
      run: |
        Invoke-WebRequest -Uri "https://www.sqlite.org/2023/sqlite-tools-win32-x86-3420000.zip" -OutFile "sqlite-tools.zip"
        Expand-Archive -Path "sqlite-tools.zip" -DestinationPath "sqlite-tools"
        Copy-Item "sqlite-tools\sqlite-tools-win32-x86-3420000\sqlite3.exe" -Destination "."
        New-Item -ItemType Directory -Force -Path "data"
      shell: powershell
    
    - name: Test CREATE_DB_FILE
      run: .\CREATE_DB_FILE.bat
      shell: cmd
      continue-on-error: true
    
    - name: Clean and Test IMPORT_CSV_DATA
      run: |
        del /f /q *.db 2>nul
        .\IMPORT_CSV_DATA.bat
      shell: cmd
      continue-on-error: true
    
    - name: Clean and Test IMPORT_TSV_DATA
      run: |
        del /f /q *.db 2>nul
        .\IMPORT_TSV_DATA.bat
      shell: cmd
      continue-on-error: true
    
    - name: Test DUMP_DB
      run: |
        .\CREATE_DB_FILE.bat
        .\DUMP_DB.bat
      shell: cmd
      continue-on-error: true
    
    - name: Test IMPORT_DB
      run: |
        del /f /q *.db 2>nul
        .\IMPORT_DB.bat
      shell: cmd
      continue-on-error: true
    
    - name: Verify database exists
      run: |
        if (Test-Path "*.db") {
          Write-Host "Database files created successfully"
          Get-ChildItem *.db
        } else {
          Write-Error "No database files found"
          exit 1
        }
      shell: powershell